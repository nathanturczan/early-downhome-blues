<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Early Downhome Blues - Melody Generator</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="stylesheet" href="https://use.typekit.net/zex5snw.css">
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/tone@14"></script>
    <script src="https://cdn.jsdelivr.net/npm/vexflow@4.2.2/build/cjs/vexflow.js"></script>
</head>
<body>
    <div class="header">
        <img src="icon.png" alt="Blues" class="header-icon">
        <div class="header-text">
            <h1>
                <span class="title-early-downhome">Early Downhome</span>
                <span class="title-blues">Blues</span>
            </h1>
            <p class="subtitle">Walking the Blues Scale</p>
        </div>
        <button id="info-btn" class="info-btn" type="button" aria-label="Information">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                <text x="12" y="17" text-anchor="middle" fill="currentColor" font-size="14" font-family="Georgia, serif" font-style="italic">i</text>
            </svg>
        </button>
        <button id="audio-toggle" class="audio-toggle is-off" type="button" aria-label="Toggle audio">
            <svg class="audio-icon" viewBox="50 120 600 820" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
                <g transform="matrix(-1 0 0 -1 669.57 1049.9)">
                    <path
                        style="stroke-linejoin:round;fill-rule:evenodd;stroke:currentColor;stroke-linecap:round;stroke-width:5.9241;fill:currentColor"
                        d="m326.09 223.84c-26.945 0.30383-53.516 9.6369-76.656 23.562-34.633 18.379-71.629 47.097-72.875 89.906-0.84896 68.928-2.0988 134.26-2.2246 197.3-0.0684 34.285 0.19552 67.896 1.0371 101.04 0.71813 61.747 1.2222 123.5 1.4375 185.25 0.36593 12.973 21.473 16.135 26.438 4.6562 14.32-21.136 21.703-46.746 40.156-65 21.135-27.835 48.151-50.895 69.094-79.062 15.157-19.681 26.545-42.15 36.062-65.344 11.587-31.757 6.5491-67.411-5.8125-98.5-11.861-19.893-22.966-1.3151-19.072 12.118 4.1143 42.042-18.613 104.69-44.428 131.13-16.772 14.701-35.806 47.091-61.375 35.938-16.885-10.637-9.5264-32.115-11.344-48.688-0.3713-37.723-1.0624-80.647-0.84375-113.19 0.21869-32.541 1.4447-57.469 2.3125-108.38 2.3903-17.098 7.7188-34.867 26.875-28.812 39.201 14.915 85.221 10.405 121.62-10.344 37.084-16.471 67.22-55.32 65-97.031-0.69789-35.974-35.165-60.27-68.469-63.688-8.9535-2.0687-17.956-2.9763-26.938-2.875z"
                        transform="matrix(-1 0 0 -1 595.49 1051.9)"
                    />
                </g>
                <line class="audio-slash" x1="110" y1="170" x2="634" y2="882" stroke="currentColor" stroke-width="40" stroke-linecap="round"/>
            </svg>
        </button>
    </div>

    <div class="main-content">
        <div class="top-row">
            <div class="left-panel">
                <div class="notation-container">
                    <div id="notation"></div>
                </div>

                <div class="controls">
                    <div class="note-box current">
                        <span class="note-box-label">Current Note</span>
                        <div class="note-display">
                            <div class="current-note" id="currentNote">g</div>
                            <div class="note-info" id="noteInfo">392.00 Hz</div>
                        </div>
                    </div>
                    <div class="note-box paths">
                        <span class="note-box-label">Paths</span>
                        <div class="paths-box">
                            <div class="paths-notes" id="pathsNotes"></div>
                            <button id="nextBtn">Random</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Drone Section -->
            <div class="drone-section">
            <div class="drone-header">
                <div class="drone-title">Drone</div>
                <div class="inflect-toggles">
                    <div class="inflect-toggle">
                        <input type="checkbox" id="inflectToggle">
                        <label for="inflectToggle">Inflect</label>
                    </div>
                    <div class="inflect-toggle">
                        <input type="checkbox" id="latchToggle" disabled>
                        <label for="latchToggle" class="disabled">Latch</label>
                    </div>
                </div>
            </div>
            <div class="drone-rows">
                <div class="drone-row">
                    <div class="drone-label">7th</div>
                    <div class="drone-buttons">
                        <button class="drone-btn" data-note="Bb2">B♭2</button>
                        <button class="drone-btn" data-note="Bb3">B♭3</button>
                        <button class="drone-btn" data-note="Bb4">B♭4</button>
                    </div>
                </div>
                <div class="drone-row">
                    <div class="drone-label">5th</div>
                    <div class="drone-buttons">
                        <button class="drone-btn" data-note="G2">G2</button>
                        <button class="drone-btn" data-note="G3">G3</button>
                        <button class="drone-btn" data-note="G4">G4</button>
                    </div>
                </div>
                <div class="drone-row">
                    <div class="drone-label">3rd</div>
                    <div class="drone-buttons">
                        <button class="drone-btn" data-note="Eb2">E♭2</button>
                        <button class="drone-btn" data-note="Eb3">E♭3</button>
                        <button class="drone-btn" data-note="Eb4">E♭4</button>
                    </div>
                </div>
                <div class="drone-row">
                    <div class="drone-label">Root</div>
                    <div class="drone-buttons">
                        <button class="drone-btn" data-note="C2">C2</button>
                        <button class="drone-btn" data-note="C3">C3</button>
                        <button class="drone-btn" data-note="C4">C4</button>
                        <button class="drone-btn" data-note="C5">C5</button>
                    </div>
                </div>
                <div class="drone-row chord-row">
                    <div class="drone-label">Chord</div>
                    <div class="drone-buttons chord-buttons">
                        <button class="chord-btn active" data-chord="I">I</button>
                        <button class="chord-btn" data-chord="bIII">&#9837;III</button>
                        <button class="chord-btn" data-chord="IV">IV</button>
                        <button class="chord-btn" data-chord="V">V</button>
                        <button class="chord-btn" data-chord="bVII">&#9837;VII</button>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- end top-row -->

        <div class="history">
            <h3>History</h3>
            <div class="history-notes" id="history"></div>
        </div>

        <div class="description-wrapper">
            <p class="description">
                Randomly walk through Jeff Todd Titon's pitch network from
                <em>Early Downhome Blues</em> (Fig. 64). Click notes or use the button to explore the mode.
            </p>
        </div>
    </div>

    <!-- MIDI Footer -->
    <div class="midi-footer">
        <button class="midi-toggle" id="midiToggle" title="Toggle MIDI panel">
            <span class="midi-toggle-label">MIDI</span>
            <span class="midi-toggle-arrow">&#9660;</span>
        </button>
        <div class="midi-section">
            <div class="midi-outputs" id="midiOutputs">
                <div class="midi-row" data-row-id="0">
                    <div class="midi-select">
                        <label>Type</label>
                        <select class="midi-type">
                            <option value="melody" selected>Melody</option>
                            <option value="root">Drone Root</option>
                            <option value="third">Drone 3rd</option>
                            <option value="fifth">Drone 5th</option>
                            <option value="seventh">Drone 7th</option>
                        </select>
                    </div>
                    <div class="midi-select">
                        <label>Port</label>
                        <select class="midi-port">
                            <option value="">None</option>
                        </select>
                    </div>
                    <div class="midi-select">
                        <label>Ch</label>
                        <select class="midi-channel">
                            <option value="0">1</option>
                            <option value="1">2</option>
                            <option value="2">3</option>
                            <option value="3">4</option>
                            <option value="4">5</option>
                            <option value="5">6</option>
                            <option value="6">7</option>
                            <option value="7">8</option>
                            <option value="8">9</option>
                            <option value="9">10</option>
                            <option value="10">11</option>
                            <option value="11">12</option>
                            <option value="12">13</option>
                            <option value="13">14</option>
                            <option value="14">15</option>
                            <option value="15">16</option>
                        </select>
                    </div>
                    <button class="midi-remove-btn hidden" title="Remove">&times;</button>
                </div>
            </div>
            <button class="midi-add-btn" id="addMidiOutput">+ Add Output</button>
        </div>
        <span class="midi-hint">*Pitch bend ±2 semitones for quarter-tones</span>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <button class="modal-close" aria-label="Close">&times;</button>
            <h2>About This App</h2>
            <p>This interactive tool lets you explore the <strong>pitch transition network</strong> from Jeff Todd Titon's influential book <em>Early Downhome Blues: A Musical and Cultural Analysis</em> (Figure 64).</p>

            <h3>The Network</h3>
            <p>Titon analyzed early blues recordings and mapped how melodies move between notes. This network captures those patterns, including:</p>
            <ul>
                <li><strong>Quarter-tones</strong> &mdash; The "blue third" (E quarter-flat) sits between E&#9837; and E</li>
                <li><strong>Sink notes</strong> &mdash; C is a resolution point with no outgoing paths</li>
                <li><strong>Hub notes</strong> &mdash; G connects to the most destinations</li>
            </ul>

            <h3>How to Use</h3>
            <ul>
                <li><strong>Click notes</strong> on the staff or in the Paths box to navigate</li>
                <li><strong>Random</strong> picks a random valid next note</li>
                <li><strong>Drone</strong> toggles sustained notes; check "Inflect" to bend them with the melody</li>
                <li><strong>MIDI Output</strong> sends notes to external instruments (set pitch bend to &plusmn;2 semitones)</li>
            </ul>

            <h3>Reference</h3>
            <p>Titon, Jeff Todd. <em>Early Downhome Blues: A Musical and Cultural Analysis</em>. 2nd ed., University of North Carolina Press, 1994.</p>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>
</body>
</html>
